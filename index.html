<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Meme Generator</title>
  <style>
    /* 전체 화면 레이아웃 */
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      min-height: 100vh; 
      font-family: sans-serif;
      background: #fff;
    }
    .container {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding-top: 30vh; /* 화면 위에서 30% 정도 아래에 위치 */
      box-sizing: border-box;
    }
    .wrapper {
      text-align: center;
      width: 100%;
      max-width: 600px;
      margin: 0 auto;
    }

    /* 라벨 (Tell us about your day!) */
    #sentence-form label {
      display: block;
      font-size: 1.8rem;
      margin-bottom: 1.8rem;
    }

    /* 댓글 한 줄: 프로필 + 글작성칸 + 전송 버튼 */
    .comment-row {
      display: flex;
      align-items: center;
      gap: 1rem;
      justify-content: center;
      margin-bottom: 1.6rem;
    }

    /* 프로필 + 드롭다운 */
    .profile-area {
      position: relative;
    }

    /* 프로필 이미지 (기본 pepe.jpg) */
    .profile-img {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      object-fit: cover;
      cursor: pointer;
    }

    /* 역삼각형 버튼 (드롭다운) */
    #char-dropdown-btn {
      position: absolute;
      bottom: 0;
      right: 0;
      background: none;
      border: none;
      font-size: 1.2rem;
      cursor: pointer;
      transform: translate(20%, -20%);
    }

    /* 드롭다운 메뉴 (이미지들) */
    .dropdown-menu {
      position: absolute;
      top: 70px;
      left: 0;
      border: 1px solid #ccc;
      background: #fff;
      display: none;
      padding: 0.5rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }
    .dropdown-menu.active {
      display: block;
    }

    /* 이미지 옵션 (char-option) */
    .char-option {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      object-fit: cover;
      margin: 0.3rem;
      cursor: pointer;
    }
    .char-option:hover {
      outline: 2px solid #333;
    }

    /* 글 작성칸 */
    .comment-box {
      flex: 1;
      height: 40px;
      resize: none;
      font-size: 1rem;
      padding: 0.5rem;
      box-sizing: border-box;
      text-align: left;
    }
    .comment-box::placeholder {
      font-size: 1rem;
    }

    /* 전송 버튼(화살표) */
    #submit-btn {
      font-size: 1.4rem;
      margin-top: 0;
      cursor: pointer;
      background: none;
      border: 1px solid #999;
      padding: 0.2rem 0.6rem;
      line-height: 1;
    }

    /* 밈 결과 */
    #meme-result {
      margin-top: 0.4rem;
    }
  </style>
</head>
<body>

  <div class="container">
    <div class="wrapper">
      <form id="sentence-form">
        <label>Tell us about your day!</label>

        <div class="comment-row">
          <!-- 프로필 + 드롭다운 -->
          <div class="profile-area">
            <!-- 기본: pepe.jpg -->
            <img id="profile-img" 
                 src="images/pepe.jpg" 
                 alt="Profile Image" 
                 class="profile-img">
            <button type="button" id="char-dropdown-btn">&#9660;</button>

            <!-- 드롭다운: cheems, wojak, pepe -->
            <div id="char-dropdown-menu" class="dropdown-menu">
              <!-- 이미지로만 표시 (텍스트 없음) -->
              <img src="images/pepe.jpg" class="char-option" data-img="images/pepe.jpg" alt="pepe">
              <img src="images/cheems.jpg" class="char-option" data-img="images/cheems.jpg" alt="cheems">
              <img src="images/wojak.jpg" class="char-option" data-img="images/wojak.jpg" alt="wojak">
            </div>
          </div>

          <!-- 글 작성칸 -->
          <textarea 
            id="input-sentence" 
            class="comment-box" 
            placeholder="Ex: I locked my keys in my car..." 
            required
          ></textarea>

          <!-- 전송 버튼(위 화살표) -->
          <button type="button" id="submit-btn">&#8593;</button>
        </div>
      </form>

      <div id="meme-result"></div>
    </div>
  </div>

  <script>
    /* 서버리스 함수 URL (GPT+구글밈) */
    const BACKEND_URL = "https://nodejs-serverless-function-express-eight-navy.vercel.app/api/summarize-and-search.js";

    const sentenceForm = document.getElementById("sentence-form");
    const profileImg = document.getElementById("profile-img");
    const charDropdownBtn = document.getElementById("char-dropdown-btn");
    const charDropdownMenu = document.getElementById("char-dropdown-menu");
    const charOptions = document.querySelectorAll(".char-option");
    const sentenceInput = document.getElementById("input-sentence");
    const submitBtn = document.getElementById("submit-btn");
    const memeResultDiv = document.getElementById("meme-result");

    // 드롭다운 열고 닫기
    charDropdownBtn.addEventListener("click", () => {
      charDropdownMenu.classList.toggle("active");
    });

    // 캐릭터 선택 -> 프로필 교체
    charOptions.forEach(option => {
      option.addEventListener("click", () => {
        const newImg = option.getAttribute("data-img");
        profileImg.src = newImg;
        charDropdownMenu.classList.remove("active");
      });
    });

    // Enter -> 전송
    sentenceInput.addEventListener("keydown", e => {
      if(e.key === "Enter"){
        e.preventDefault();
        generateMeme();
      }
    });

    // 버튼 클릭 -> 전송
    submitBtn.addEventListener("click", generateMeme);

    async function generateMeme(){
      memeResultDiv.innerHTML = "";
      const userSentence = sentenceInput.value.trim();
      if(!userSentence){
        alert("Please enter something!");
        return;
      }

      memeResultDiv.innerHTML = "<p>Loading...</p>";
      try {
        const response = await fetch(BACKEND_URL, {
          method: "POST",
          headers: { "Content-Type": "text/plain" },
          body: JSON.stringify({ userSentence })
        });
        if(!response.ok){
          memeResultDiv.innerHTML = `<p>Request failed: ${response.status} ${response.statusText}</p>`;
          return;
        }
        const data = await response.json();
        if(data.error){
          memeResultDiv.innerHTML = `<p>Error: ${data.error.message || data.error}</p>`;
          return;
        }

        sentenceForm.style.display = "none";
        const { imageUrl } = data;
        memeResultDiv.innerHTML = `<img src="${imageUrl}" alt="Meme Image" style="max-width:400px;">`;
      } catch(err){
        memeResultDiv.innerHTML = `<p>An error occurred: ${err}</p>`;
      }
    }
  </script>
</body>
</html>
